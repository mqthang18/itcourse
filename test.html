<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="shortcut icon" href="./assets/img/logo/mylogo.png" type="image/x-icon">
  <link rel="stylesheet" href="./assets/css/bootstrap/bootstrap.min.css">
  <script src="./assets/js/bootstrap/bootstrap.bundle.min.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
  <title>Bài 5. THIẾT KẾ CƠ SỞ DỮ LIỆU</title>
</head>

<body>
  <h3>Bài 5. Lập trình cơ sở dữ liệu</h3>

  <div id="tableContent">
    <h4>Nội dung</h4>

    <ol>
      <li>Giới thiệu về ADO.NET</li>
      <li>Đối tượng SQLCONNECTION</li>
      <li>Đối tượng SQLCOMMAND</li>
      <li>Đối tượng SQLDATAREADER</li>
      <li>Đối tượng DATA - DATASET</li>
      <li>Tạo báo biểu (REPORT)</li>
    </ol>
  </div>

  <div id="aim">
    <h4>Mục tiêu của bài học</h4>
    <ol>
      <li>Giúp học viên hiểu rõ hơn về khái niệm ADO.NET</li>
      <li>Học viện hiểu các khái niệm và sử dụng được các đối tượng:
        Connection, Command, DataReader, Dataset, DataAdapter</li>
      <li>Giúp học viên tạo được báo biểu (report)</li>
      <li>Lập trình được một phần mềm quản lý</li>
    </ol>
  </div>

  <div id="1">
    <h4>Giới thiệu về ADO.NET</h4>

    <p>
      <a class="btn btn-primary" data-bs-toggle="collapse" href="#collapse11" role="button" aria-expanded="false"
        aria-controls="collapse11">
        Giới thiệu
      </a>
      <a class="btn btn-primary" data-bs-toggle="collapse" href="#collapse12" role="button" aria-expanded="false"
        aria-controls="collapse12">
        Data Provider
      </a>
      <a class="btn btn-primary" data-bs-toggle="collapse" href="#collapse13" role="button" aria-expanded="false"
        aria-controls="collapse13">
        Các đối tượng của ADO.NET
      </a>
    </p>

    <div>
      <div class="collapse" id="collapse11">
        <div class="card card-body">
          <p>ADO.NET (ActiveX Data Object .NET): là công nghệ của MS trên .NET FrameWork, phát triển từ nền tảng ADO,
            cung cấp các lớp đối tượng và hàm thư viện phục vụ cho kết nối và xử lý dữ liệu.</p>
          <p>ADO.NET cho phép tương tác với các loại dữ liệu và các kiểu cơ sở dữ liệu. Mỗi loại dữ liệu cần một cách
            thức khác nhau để truy xuất (các loại dữ liệu cũ sử dụng giao thức ODBC, các loại dữ liệu mới hơn sử dụng
            giao thức OleDb) => vì vậy cần một thư viện thống nhất để làm việc với tất cả các loại dữ liệu, đó chính là
            ADO.NET.</p>
          <p>Kiến trúc ADO.NET gồm 2 phần:</p>
          <p>
            <a class="btn btn-primary" data-bs-toggle="collapse" href="#collapse111" role="button" aria-expanded="false"
              aria-controls="collapse111">
              Phần kết nối
            </a>
            <a class="btn btn-primary" data-bs-toggle="collapse" href="#collapse112" role="button" aria-expanded="false"
              aria-controls="collapse112">
              Phần ngắt kết nối
            </a>
          </p>

          <div>
            <div class="collapse" id="collapse111">
              <div class="card card-body">
                <p><b>Phần kết nối</b></p>
                <p>Sử dụng khi kết nối CSDL và thao tác với dữ liệu, phải
                  thực hiện kết nối khi thao tác.</p>
                <ul>
                  <li><b>Connection</b>: quản lý đóng/mở database.</li>
                  <li><b>Command</b>: lệnh truy vấn, tương tác dữ liệu khi đang kết nối</li>
                  <li><b>DataReader</b>: đọc dữ liệu, chỉ xử lý 1 dòng dữ liệu tại một thời điểm</li>
                  <li><b>DataAdapter</b>: đối tượng trung gian giúp database và dataset kết nối</li>
                </ul>
              </div>
            </div>
            <div class="collapse" id="collapse112">
              <div class="card card-body">
                <p><b>Phần ngắt kết nối</b>: Dataset</p>
                <ul>
                  <li>DataSet không quan tâm đến database, chỉ lấy dữ liệu từ DataAdapter để xử lý.</li>
                  <li>DataSet được xem như một database trong bộ nhớ</li>
                  <li>DataSet có các thành phần như: DataTable, DataRow, DataColumn, DataRelation....
                  </li>
                </ul>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="collapse" id="collapse12">
        <div class="card card-body">
          <h4>Data Provider</h4>
          <p>ADO.NET cung cấp cách thức chung để tương tác với nguồn dữ liệu nhưng với mỗi loại dữ liệu khác nhau thì
            phải sử dụng thư viện khác nhau (OBDC, OleDb, Oracle, SQL). Các thư viện này được gọi là Data Provider và
            thường được đặt tên theo giao thức hoặc loại dữ liệu cho phép truy xuất</p>
          <center>
            <img src="./assets/img/LTUDWindows/chap5/img1.png" alt="" class="w-75">
          </center>
        </div>
      </div>
      <div class="collapse" id="collapse13">
        <div class="card card-body">
          <h4>Các đối tượng của ADO.NET</h4>
          <ul>
            <ul>
              <li><b>SqlConnection</b>: dùng để kết nối với cơ sở dữ liệu (database), Khi kết nối với data thì cần phải
                cung cấp: tên máy chủ (Database server), tên cơ sở dữ liệu (database name), người dùng (username – nếu
                cần), mật khẩu (password – nếu cần) và các tham số cần thiết khác.</li>
              <li><b>SqlCommand</b>: Dùng để thực thi các câu truy vấn sau khi kết nối thành công.</li>
              <li><b>SqlDataReader</b>: Dùng để đọc dữ liệu từ cơ sở dữ liệu</li>
              <li><b>Dataset</b>: để chứa dữ liệu theo dạng dòng, cột giống như table.</li>
              <li><b>SqlDataAdapter</b>: là nơi để lưu dữ liệu tạm thời khi giúp hạn chế truy xuất đến cơ sở dữ liệu
              </li>
            </ul>
          </ul>
        </div>
      </div>
    </div>
  </div>

  <div id="2">
    <h4>Đối tượng SQLCONNECTION</h4>

    <p>
      <a class="btn btn-primary" data-bs-toggle="collapse" href="#collapse21" role="button" aria-expanded="false"
        aria-controls="collapse21">
        Giới thiệu
      </a>
      <a class="btn btn-primary" data-bs-toggle="collapse" href="#collapse22" role="button" aria-expanded="false"
        aria-controls="collapse22">
        Tạo đối tượng SqlConnection
      </a>
      <a class="btn btn-primary" data-bs-toggle="collapse" href="#collapse23" role="button" aria-expanded="false"
        aria-controls="collapse23">
        Sử dụng đối tượng SqlConnection
      </a>
    </p>
    <div>
      <div class="collapse" id="collapse21">
        <div class="card card-body">
          <h4>Giới thiệu</h4>
          <div class="container-fluid">
            <div class="row">
              <div class="col-12 col-sm-6">
                <p><b>SqlConnection</b> dùng để kết nối với cơ sở dữ liệu SQL</p>
                <p>Thuộc tính và phương thức thường dùng</p>
                <ul>
                  <li><b>ConnectionString</b>: Chuỗi kết nối đến DataBase</li>
                  <li><b>Open():</b> Mở kết nối đến DataBase</li>
                  <li><b>Close():</b> Đóng kết nối</li>
                </ul>
              </div>
              <div class="col-12 col-sm-6">
                <center>
                  <img src="./assets/img/LTUDWindows/chap5/img2.png" alt="" class="w-100">
                </center>
              </div>
            </div>
          </div>

        </div>
      </div>
      <div class="collapse" id="collapse22">
        <div class="card card-body">
          <h4>Tạo đối tượng SqlConnection</h4>

          <p>Cú pháp</p>
          <pre>
SqlConnection conn = new SqlConnection
{
  "Data Source=DESKTOP-012NMST
  Initial Catalog=QuanLySinhVien;
  Integrated Security=True";

}
          </pre>
        </div>
      </div>
      <div class="collapse" id="collapse23">
        <div class="card card-body">
          <h4>Sử dụng đối tượng SqlConnection</h4>

          <p>Sau khi kết nối thành công thì các đối tượng khác trong ADO.NET mới có thể thao tác được với database. Các
            bước sử dụng đối tượng SqlConnection</p>
          <ul>
            <li><b>Bước 1.</b> Tạo SqlConnection</li>
            <li><b>Bước 2.</b> Mở Connection</li>
            <li><b>Bước 3.</b> Truyền connection có các đối tượng khác sử dụng.</li>
            <li><b>Bước 4.</b> Thực hiện các thao tác với database</li>
            <li><b>Bước 5.</b> Đóng connection
            </li>
          </ul>

          <p><b>Ví dụ</b>. Thực hiện kết nối và hiển thị thông báo tương ứng
          </p>

          <center>
            <img src="./assets/img/LTUDWindows/chap5/img3.png" alt="" class="w-75">
          </center>

          <pre>
static String connStr1 = "Data Source=DESKTOP-012NMST;Initial 
Catalog=QLGIANGVIEN;Integrated Security=True";
SqlConnection conn = new SqlConnection(connStr1);
void loginSystem(){
  try{
    conn.Open();
    MessageBox.Show("Kết nối thành công!!!", "Thông báo");
  }
  catch{
    MessageBox.Show("Kết nối thất bại!!!", "Thông báo");
  }
  finally{
    conn.Close();
  }
}
          </pre>
        </div>
      </div>
    </div>
  </div>

  <div id="3">
    <h4>Đối tượng SQLCOMMAND</h4>
    <p>
      <a class="btn btn-primary" data-bs-toggle="collapse" href="#collapse41" role="button" aria-expanded="false"
        aria-controls="collapse41">
        Giới thiệu
      </a>
      <a class="btn btn-primary" data-bs-toggle="collapse" href="#collapse42" role="button" aria-expanded="false"
        aria-controls="collapse42">
        Tạo đối tượng SqlCommand
      </a>
      <a class="btn btn-primary" data-bs-toggle="collapse" href="#collapse43" role="button" aria-expanded="false"
        aria-controls="collapse43">
        Query Data - truy vấn dữ liệu
      </a>
      <a class="btn btn-primary" data-bs-toggle="collapse" href="#collapse44" role="button" aria-expanded="false"
        aria-controls="collapse44">
        Inserting Data – Chèn dữ liệu
      </a>
      <a class="btn btn-primary" data-bs-toggle="collapse" href="#collapse45" role="button" aria-expanded="false"
        aria-controls="collapse45">
        Updating Data – Cập nhật dữ liệu
      </a>
      <a class="btn btn-primary" data-bs-toggle="collapse" href="#collapse46" role="button" aria-expanded="false"
        aria-controls="collapse46">
        Deleting Data – Xóa dữ liệu
      </a>
      <a class="btn btn-primary" data-bs-toggle="collapse" href="#collapse47" role="button" aria-expanded="false"
        aria-controls="collapse47">
        Lấy giá trị đơn
      </a>
    </p>

    <div>
      <div class="collapse" id="collapse41">
        <div class="card card-body">
          <h4>Giới thiệu</h4>
          <p>Đối tượng <b>SqlCommand</b> cho phép tương tác (select, update, delete,...) với cơ sở dữ liệu</p>

          <center>
            <img src="./assets/img/LTUDWindows/chap5/img4.png" alt="" class="w-75">
          </center>
        </div>
      </div>
      <div class="collapse" id="collapse42">
        <div class="card card-body">
          <h4>Tạo đối tượng SqlCommand</h4>

          <p><b>Cú pháp</b></p>
          <pre>
SqlCommand cmd = new SqlCommand
(
  "Select * from Login", conn
);            
          </pre>
        </div>
      </div>
      <div class="collapse" id="collapse43">
        <div class="card card-body">
          <h4>Query Data - truy vấn dữ liệu</h4>
          <p>Sử dụng phương thức <b>ExecuteReader()</b> của đối tượng SqlCommand để lấy dữ liệu từ cơ sở dữ liệu, dữ
            liệu trả về thường dùng SqlDataReader để lưu dữ liệu</p>
          <p>Cú pháp</p>
          <pre>
SqlDataReader rdr = cmd.ExecuteReader();
          </pre>

          <center>
            <img src="./assets/img/LTUDWindows/chap5/img5.png" alt="" class="w-75">
            <img src="./assets/img/LTUDWindows/chap5/img6.png" alt="" class="w-75">
          </center>

          <pre>
private void btnDangNhap_Click(object sender, EventArgs e)
{
    String tendn = txtTenDN.Text;
    String mk = txtMatKhau.Text;
    conn.Open();
    SqlCommand cmd = new SqlCommand( "Select * from TaiKhoan where TenDN = '“ + tendn + "' and MatKhau = '"+ mk + "'", conn);
    SqlDataReader rdr = cmd.ExecuteReader();
    if (rdr.Read())
    {
      fGiangVien f = new fGiangVien();
      this.Hide();
      f.ShowDialog();
    }
    else
      MessageBox.Show("Tên tài khoản hoặc mật khẩu không chính xác!!!");
    conn.Close();
}
          </pre>
        </div>
      </div>
      <div class="collapse" id="collapse44">
        <div class="card card-body">
          <h4>Inserting Data – Chèn dữ liệu</h4>

          <p>Sử dụng phương thức <b>ExecuteNonQuery()</b> của đối tượng SqlCommand để lấy dữ liệu từ cơ sở dữ liệu.</p>

          <p>Cú pháp</p>
          <pre>
String insertdata = @"insert into Login (UserName, Password, Type) 
values ('phuong','123456','0')";
SqlCommand cmd = new SqlCommand(insertdata, conn);
cmd.ExecuteNonQuery();
          </pre>

          <p>Ví dụ: Thêm dữ liệu</p>
          <center>
            <img src="./assets/img/LTUDWindows/chap5/img7.png" alt="" class="w-75">
          </center>
          <pre>
private void btnThemSV_Click(object sender, EventArgs e)
{
    conn.Open();
    String sql = @"insert into GiangVien "+
    "values ('"+ txtMaGV.Text +"',N'" + txtHoTen.Text + "‘, 
    '"+txtNamSinh.Text+"','"+txtDienThoai.Text+"',
    N'"+cmbGioiTinh.Text+"',N'"+cmbDiaChi.Text+"')";
    SqlCommand cmd = new SqlCommand(sql1, conn);
    cmd.ExecuteNonQuery();
    conn.Close();
    LoadData();
}
            
          </pre>
        </div>
      </div>
      <div class="collapse" id="collapse45">
        <div class="card card-body">
          <h4>Updating Data – Cập nhật dữ liệu</h4>
          <p>Cũng sử dụng phương thức <b>ExecuteNonQuery()</b> của đối tượng SqlCommand để cập nhật dữ liệu.</p>

          <p>Cú pháp</p>

          <pre>
String updatedata = @"Update Login set PassWord ='678901' where UserName ='Phuong'";
SqlCommand cmd = new SqlCommand(updatedata, conn);
cmd.ExecuteNonQuery();
          </pre>

          <p>Ví dụ: cập nhật dữ liệu</p>

          <center>
            <img src="./assets/img/LTUDWindows/chap5/img8.png" alt="" class="w-75">
          </center>

          <pre>
private void btnSuaSV_Click(object sender, EventArgs e)
{
    conn.Open();
    String sql = @"Update GiangVien set HoTen =N'" + txtHoTen.Text+ "',
    NamSinh = '"+txtNamSinh.Text+"', GioiTinh =N'"+cmbGioiTinh.Text+"', 
    DienThoai = '"+txtDienThoai.Text+"', DiaChi = N'"+cmbDiaChi.Text+"' 
    where MaGV ='" + txtMaGV.Text + "'";
    SqlCommand cmd = new SqlCommand(sql1, conn);
    cmd.ExecuteNonQuery();
    conn.Close();
    LoadData();
}

          </pre>
        </div>
      </div>
      <div class="collapse" id="collapse46">
        <div class="card card-body">
          <h4>Deleting Data – Xóa dữ liệu</h4>
          <p>Cũng sử dụng phương thức ExecuteNonQuery() của đối tượng
            SqlCommand để xóa dữ liệu</p>
          <p><b>Cú pháp</b></p>

          <pre>
String updatedata = @"Delete From Login
where UserName ='Phuong'";
SqlCommand cmd = new SqlCommand(updatedata, conn); 
cmd.ExecuteNonQuery();            
          </pre>

          <p>Ví dụ: Xóa dữ liệu</p>
          <center>
            <img class="w-75" src="./assets/img/LTUDWindows/chap5/img9.png" alt="">
          </center>
          
          <pre>
private void btnXoaSV_Click(object sender, EventArgs e)
{
    conn.Open();
    String sql = @"Delete From GiangVien 
    where MaGV ='" + txtMaGV.Text + "'";
    String sql1 = "SP_XoaGV '"+ txtMaGV.Text + "'";
    SqlCommand cmd = new SqlCommand(sql1, conn);
    cmd.ExecuteNonQuery();
    conn.Close();
    LoadData();
}

          </pre>
        </div>
      </div>
      <div class="collapse" id="collapse47">
        <div class="card card-body">
          <p>Sử dụng phương thức <b>ExecuteScalar()</b> của đối tượng SqlCommand để lấy về một giá trị nào đó: đếm, tổng, trung bình,...</p>
          <p>Cú pháp</p>

          <pre>
String updatedata = @"Select count(*) from Login";
SqlCommand cmd = new SqlCommand(updatedata, conn);
int count = (int)cmd.ExecuteScalar();
          </pre>

          <p>Ví dụ: Thống kê số lượng giảng viên
          </p>

          <center>
            <img src="./assets/img/LTUDWindows/chap5/img10.png" alt="" class="w-75">
          </center>

          <pre>
private void btnDem_Click(object sender, EventArgs e)
{
    conn.Open();
    String sql = @"Select count(*) from GiangVien";
    SqlCommand cmd = new SqlCommand(sql, conn);
    int count = (int)cmd.ExecuteScalar();
    String msg = String.Format("Số lượng giảng viên là {0}"
    , count);
    MessageBox.Show(msg, "Thông báo");
    conn.Close();
}

          </pre>
        </div>
      </div>
    </div>
  </div>

  <div id="4">
    <h4>Đối tượng SQLDATAREADER</h4>

  </div>

  <div id="5">
    <h4>Đối tượng DATA - DATASET</h4>



  </div>

  <div id="6">
    <h4>Tạo báo biểu (REPORT)</h4>
  </div>
</body>

</html>